<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Canvas - Dashboard</title>
  <link rel="icon" href="https://du11hjcvx0uqb.cloudfront.net/dist/images/favicon-e10d657a73.ico">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg-primary: #0a0a0f;
      --bg-card: #1a1a2e;
      --accent: #6366f1;
      --accent-glow: rgba(99, 102, 241, 0.3);
      --accent-light: #818cf8;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --border: rgba(99, 102, 241, 0.15);
      --success: #22c55e;
      --success-glow: rgba(34, 197, 94, 0.3);
    }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }
    .bg-grid {
      position: fixed; inset: 0;
      background-image:
        linear-gradient(rgba(99,102,241,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(99,102,241,0.03) 1px, transparent 1px);
      background-size: 60px 60px;
      z-index: 0;
    }
    .bg-glow { position: fixed; width: 600px; height: 600px; border-radius: 50%; filter: blur(150px); opacity: 0.15; z-index: 0; pointer-events: none; }
    .bg-glow-1 { top: -200px; right: -200px; background: var(--accent); animation: float 8s ease-in-out infinite; }
    .bg-glow-2 { bottom: -200px; left: -200px; background: #8b5cf6; animation: float 8s ease-in-out infinite reverse; }
    @keyframes float { 0%,100%{transform:translate(0,0)} 50%{transform:translate(30px,-30px)} }
    .container {
      position: relative; z-index: 1; max-width: 800px; margin: 0 auto; padding: 40px 24px;
      min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .card {
      background: var(--bg-card); border: 1px solid var(--border); border-radius: 24px; padding: 48px;
      width: 100%; max-width: 580px; backdrop-filter: blur(20px);
      box-shadow: 0 0 80px rgba(99,102,241,0.05); animation: cardIn 0.6s cubic-bezier(0.16,1,0.3,1);
    }
    @keyframes cardIn { from{opacity:0;transform:translateY(30px) scale(0.96)} to{opacity:1;transform:translateY(0) scale(1)} }
    .shield-icon {
      width: 72px; height: 72px; border-radius: 20px;
      background: linear-gradient(135deg, var(--accent), #8b5cf6);
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 28px; box-shadow: 0 8px 32px var(--accent-glow); position: relative;
    }
    .shield-icon svg { width: 36px; height: 36px; fill: white; }
    .shield-icon::after {
      content: ''; position: absolute; inset: -3px; border-radius: 22px;
      background: linear-gradient(135deg, var(--accent), #8b5cf6); z-index: -1; opacity: 0.4; filter: blur(12px);
    }
    .card h1 {
      font-size: 28px; font-weight: 800; text-align: center; margin-bottom: 8px;
      background: linear-gradient(135deg, var(--text-primary), var(--accent-light));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: -0.5px;
    }
    .card .subtitle { text-align: center; color: var(--text-secondary); font-size: 15px; line-height: 1.6; margin-bottom: 32px; }
    .features { display: flex; flex-direction: column; gap: 14px; margin-bottom: 36px; }
    .feature {
      display: flex; align-items: center; gap: 14px; padding: 14px 18px;
      background: rgba(99,102,241,0.06); border: 1px solid rgba(99,102,241,0.1);
      border-radius: 14px; transition: all 0.2s;
    }
    .feature:hover { background: rgba(99,102,241,0.1); border-color: rgba(99,102,241,0.2); transform: translateX(4px); }
    .feature-icon {
      width: 38px; height: 38px; border-radius: 10px; background: rgba(99,102,241,0.15);
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
    }
    .feature-icon svg { width: 18px; height: 18px; stroke: var(--accent-light); fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
    .feature-text { font-size: 14px; color: var(--text-secondary); line-height: 1.5; }
    .feature-text strong { color: var(--text-primary); font-weight: 600; }
    .btn-primary {
      width: 100%; padding: 16px 32px; border: none; border-radius: 14px; font-family: inherit;
      font-size: 16px; font-weight: 700; cursor: pointer;
      background: linear-gradient(135deg, var(--accent), #8b5cf6); color: white;
      transition: all 0.3s; position: relative; overflow: hidden; letter-spacing: 0.3px;
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 32px var(--accent-glow); }
    .btn-primary:active { transform: translateY(0); }
    .btn-primary::before { content:''; position:absolute; inset:0; background:linear-gradient(135deg,rgba(255,255,255,0.1),transparent); opacity:0; transition:opacity 0.3s; }
    .btn-primary:hover::before { opacity: 1; }
    .status-badge {
      display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px;
      border-radius: 100px; font-size: 13px; font-weight: 600; margin: 0 auto 24px; width: fit-content;
    }
    .status-badge.inactive { background: rgba(234,179,8,0.1); border: 1px solid rgba(234,179,8,0.25); color: #eab308; }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; animation: pulse 2s ease-in-out infinite; }
    .status-badge.inactive .status-dot { background: #eab308; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
    .footer-text { text-align: center; font-size: 12px; color: var(--text-muted); margin-top: 16px; line-height: 1.6; }
    .security-badges { display: flex; justify-content: center; gap: 16px; margin-top: 20px; flex-wrap: wrap; }
    .sec-badge { display: flex; align-items: center; gap: 6px; font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
    .sec-badge svg { width: 14px; height: 14px; stroke: var(--text-muted); fill: none; stroke-width: 2; }
    .loading-overlay { position: fixed; inset: 0; background: var(--bg-primary); display: flex; align-items: center; justify-content: center; z-index: 9999; transition: opacity 0.4s; }
    .loading-overlay.hidden { opacity: 0; pointer-events: none; }
    .spinner { width: 48px; height: 48px; border: 3px solid rgba(99,102,241,0.2); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to{transform:rotate(360deg)} }
    .loading-text { margin-top: 16px; font-size: 14px; color: var(--text-secondary); font-weight: 500; }
    
    /* Returning user launch screen */
    .launch-screen { text-align: center; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from{opacity:0;transform:scale(0.95)} to{opacity:1;transform:scale(1)} }
    .launch-title { font-size: 48px; font-weight: 900; margin-bottom: 16px; background: linear-gradient(135deg, #fff, var(--accent-light)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: pulse-text 1.5s ease-in-out infinite; }
    @keyframes pulse-text { 0%,100%{opacity:1} 50%{opacity:0.7} }
    .launch-subtitle { font-size: 20px; color: var(--text-secondary); margin-bottom: 40px; }
    .launch-click { font-size: 28px; font-weight: 700; color: var(--accent); animation: bounce 1s ease-in-out infinite; }
    @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
    .launch-countdown { margin-top: 32px; font-size: 64px; font-weight: 900; color: var(--accent); opacity: 0.8; }
    .launch-warning { margin-top: 16px; font-size: 14px; color: #ef4444; font-weight: 600; }
    .launch-ring { width: 200px; height: 200px; border-radius: 50%; border: 4px solid var(--accent); margin: 0 auto 30px; display: flex; align-items: center; justify-content: center; animation: ring-pulse 2s ease-in-out infinite; }
    @keyframes ring-pulse { 0%,100%{box-shadow: 0 0 0 0 rgba(99,102,241,0.4)} 50%{box-shadow: 0 0 0 30px rgba(99,102,241,0)} }
    .launch-ring svg { width: 80px; height: 80px; fill: var(--accent); }
    @media (max-width: 600px) { .card { padding: 32px 24px; } .card h1 { font-size: 22px; } }
  </style>
</head>
<body>
  <div class="bg-grid"></div>
  <div class="bg-glow bg-glow-1"></div>
  <div class="bg-glow bg-glow-2"></div>

  <div class="loading-overlay" id="loading">
    <div style="text-align:center;" id="loadingContent">
      <div class="spinner"></div>
      <div class="loading-text" id="loadingText">Initializing...</div>
    </div>
  </div>

  <div class="container">
    <!-- FIRST TIME VIEW -->
    <div class="card" id="firstTimeCard" style="display:none;">
      <div class="shield-icon">
        <svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
      </div>
      <div class="status-badge inactive" style="display:flex;">
        <div class="status-dot"></div>
        Not Activated
      </div>
      <h1>Welcome to Secure Gateway</h1>
      <p class="subtitle">
        This is a privacy-first gaming platform disguised as a Canvas LMS portal.
        Activate to launch games in a fully cloaked environment that's undetectable.
      </p>
      <div class="features">
        <div class="feature">
          <div class="feature-icon"><svg viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></div>
          <div class="feature-text"><strong>about:blank Cloaking</strong> â€” Game runs inside an undetectable blank tab. No URL, no trace.</div>
        </div>
        <div class="feature">
          <div class="feature-icon"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div>
          <div class="feature-text"><strong>Auto-Redirect Cover</strong> â€” Original tab instantly redirects to a real Canvas login page.</div>
        </div>
        <div class="feature">
          <div class="feature-icon"><svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg></div>
          <div class="feature-text"><strong>Zero Footprint</strong> â€” No history entries, no suspicious tabs. Fully stealth.</div>
        </div>
        <div class="feature">
          <div class="feature-icon"><svg viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg></div>
          <div class="feature-text"><strong>Instant Launch</strong> â€” One click to deploy. No downloads, no installs.</div>
        </div>
      </div>
      <button class="btn-primary" onclick="activateSite()">âš¡ Activate Secure Gateway</button>
      <div class="footer-text">By activating, a cloaked tab opens with the game library.<br>This tab will redirect to Canvas as cover.</div>
      <div class="security-badges">
        <div class="sec-badge"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>Encrypted</div>
        <div class="sec-badge"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>Undetectable</div>
        <div class="sec-badge"><svg viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>Verified</div>
      </div>
    </div>
  </div>

  <script>
    // â”€â”€â”€ FULL CLOAKED APP HTML (Game Library + Game Player) â”€â”€â”€
    const CLOAKED_HTML = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Canvas - Dashboard</title>
  <link rel="icon" href="https://du11hjcvx0uqb.cloudfront.net/dist/images/favicon-e10d657a73.ico">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --bg:#0a0a0f;--bg2:#12121a;--card:#1a1a2e;--card-hover:#222240;
      --accent:#6366f1;--accent-g:rgba(99,102,241,0.3);--accent-l:#818cf8;
      --t1:#f1f5f9;--t2:#94a3b8;--t3:#64748b;--border:rgba(99,102,241,0.15);
      --green:#22c55e;--yellow:#eab308;--red:#ef4444;
    }
    body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--t1);overflow-x:hidden;min-height:100vh}

    /* â”€â”€ BG â”€â”€ */
    .bg-grid{position:fixed;inset:0;background-image:linear-gradient(rgba(99,102,241,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(99,102,241,0.03) 1px,transparent 1px);background-size:60px 60px;z-index:0;pointer-events:none}
    .bg-glow{position:fixed;width:500px;height:500px;border-radius:50%;filter:blur(140px);opacity:0.12;z-index:0;pointer-events:none}
    .g1{top:-150px;right:-150px;background:var(--accent);animation:fl 8s ease-in-out infinite}
    .g2{bottom:-150px;left:-150px;background:#8b5cf6;animation:fl 8s ease-in-out infinite reverse}
    @keyframes fl{0%,100%{transform:translate(0,0)}50%{transform:translate(30px,-30px)}}

    /* â”€â”€ TOP BAR â”€â”€ */
    .top-bar{
      position:fixed;top:0;left:0;right:0;height:56px;
      background:rgba(18,18,26,0.95);backdrop-filter:blur(20px);
      border-bottom:1px solid rgba(99,102,241,0.1);
      display:flex;align-items:center;justify-content:space-between;
      padding:0 24px;z-index:1000;transition:transform 0.3s;
    }
    .top-bar.hide{transform:translateY(-100%)}
    .bar-l,.bar-r{display:flex;align-items:center;gap:10px}
    .bar-btn{
      display:flex;align-items:center;gap:7px;padding:7px 14px;
      border:1px solid rgba(99,102,241,0.2);border-radius:10px;
      background:rgba(99,102,241,0.08);color:#c7d2fe;font-family:inherit;
      font-size:13px;font-weight:600;cursor:pointer;transition:all 0.2s;
    }
    .bar-btn:hover{background:rgba(99,102,241,0.18);border-color:rgba(99,102,241,0.35);color:#fff}
    .bar-btn svg{width:15px;height:15px;stroke:currentColor;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}
    .bar-btn.red{border-color:rgba(239,68,68,0.25);background:rgba(239,68,68,0.08);color:#fca5a5}
    .bar-btn.red:hover{background:rgba(239,68,68,0.18);border-color:rgba(239,68,68,0.4);color:#fff}
    .bar-logo{font-size:15px;font-weight:800;background:linear-gradient(135deg,#f1f5f9,#818cf8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:-0.3px}
    .bar-badge{padding:4px 10px;border-radius:6px;font-size:10px;font-weight:700;background:rgba(34,197,94,0.12);color:#22c55e;border:1px solid rgba(34,197,94,0.2);text-transform:uppercase;letter-spacing:0.6px}
    .bar-game-title{font-size:13px;font-weight:600;color:var(--t2)}

    /* â”€â”€ LIBRARY VIEW â”€â”€ */
    .library{position:relative;z-index:1;max-width:900px;margin:0 auto;padding:80px 24px 40px}
    .lib-header{margin-bottom:32px}
    .lib-header h1{font-size:32px;font-weight:900;margin-bottom:6px;background:linear-gradient(135deg,var(--t1),var(--accent-l));-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:-0.5px}
    .lib-header p{color:var(--t2);font-size:14px}

    /* Search */
    .search-wrap{position:relative;margin-bottom:28px}
    .search-wrap svg{position:absolute;left:16px;top:50%;transform:translateY(-50%);width:18px;height:18px;stroke:var(--t3);fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;pointer-events:none}
    .search-input{
      width:100%;padding:14px 16px 14px 48px;
      background:var(--card);border:1px solid var(--border);border-radius:14px;
      font-family:inherit;font-size:14px;color:var(--t1);outline:none;transition:all 0.2s;
    }
    .search-input::placeholder{color:var(--t3)}
    .search-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-g)}

    /* Filters */
    .filters{display:flex;gap:10px;margin-bottom:24px;flex-wrap:wrap}
    .filter-btn{
      padding:8px 18px;border-radius:10px;font-family:inherit;font-size:13px;font-weight:600;
      border:1px solid var(--border);background:transparent;color:var(--t2);cursor:pointer;transition:all 0.2s;
    }
    .filter-btn:hover{border-color:rgba(99,102,241,0.3);color:var(--t1)}
    .filter-btn.active{background:var(--accent);border-color:var(--accent);color:#fff}

    /* Game Grid */
    .game-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:20px}
    .game-card{
      background:var(--card);border:1px solid var(--border);border-radius:18px;
      overflow:hidden;cursor:pointer;transition:all 0.3s;position:relative;
    }
    .game-card:hover{transform:translateY(-4px);border-color:rgba(99,102,241,0.3);box-shadow:0 12px 40px rgba(99,102,241,0.1)}
    .game-thumb{width:100%;aspect-ratio:16/10;object-fit:cover;display:block;background:#12121a}
    .game-info{padding:16px}
    .game-name{font-size:15px;font-weight:700;margin-bottom:4px;color:var(--t1)}
    .game-tags{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
    .game-tag{padding:3px 10px;border-radius:6px;font-size:11px;font-weight:600;background:rgba(99,102,241,0.1);color:var(--accent-l);border:1px solid rgba(99,102,241,0.15)}
    .fav-btn{
      position:absolute;top:12px;right:12px;width:36px;height:36px;border-radius:10px;
      background:rgba(10,10,15,0.7);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,0.1);
      display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s;z-index:2;
    }
    .fav-btn:hover{background:rgba(10,10,15,0.9);border-color:rgba(234,179,8,0.4)}
    .fav-btn svg{width:18px;height:18px;stroke:#eab308;fill:none;stroke-width:2;transition:all 0.2s}
    .fav-btn.active svg{fill:#eab308}
    .no-results{text-align:center;padding:60px 20px;color:var(--t3);font-size:15px}

    /* â”€â”€ GAME VIEW â”€â”€ */
    .game-view{position:fixed;top:56px;left:0;right:0;bottom:0;background:#000;z-index:500;display:none}
    .game-view.show{display:block}
    .game-view.fs{top:0}
    .game-view iframe{width:100%;height:100%;border:none}

    /* â”€â”€ KEY HINT â”€â”€ */
    .hint{
      position:fixed;bottom:16px;right:16px;padding:8px 14px;
      background:rgba(18,18,26,0.9);backdrop-filter:blur(10px);
      border:1px solid rgba(99,102,241,0.15);border-radius:8px;
      font-size:11px;color:var(--t3);z-index:2000;pointer-events:none;transition:opacity 0.3s;
    }
    kbd{display:inline-block;padding:2px 6px;background:rgba(99,102,241,0.15);border:1px solid rgba(99,102,241,0.25);border-radius:4px;font-family:inherit;font-size:11px;color:#c7d2fe;margin:0 2px}

    @media(max-width:600px){
      .library{padding:72px 16px 32px}
      .lib-header h1{font-size:24px}
      .game-grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="bg-grid"></div>
  <div class="bg-glow g1"></div>
  <div class="bg-glow g2"></div>

  <!-- TOP BAR -->
  <div class="top-bar" id="topBar">
    <div class="bar-l">
      <button class="bar-btn" id="backBtn" onclick="goBack()" style="display:none">
        <svg viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>Back
      </button>
      <span class="bar-logo">Secure Gateway</span>
      <span class="bar-badge">Cloaked</span>
      <span class="bar-game-title" id="barGameTitle"></span>
    </div>
    <div class="bar-r">
      <button class="bar-btn" id="fsBtn" onclick="toggleFS()" style="display:none">
        <svg viewBox="0 0 24 24"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg>Fullscreen
      </button>
      <button class="bar-btn red" onclick="top.close()">
        <svg viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>Close
      </button>
    </div>
  </div>

  <!-- LIBRARY -->
  <div class="library" id="library">
    <div class="lib-header">
      <h1>Game Library</h1>
      <p>Select a game to launch in stealth mode. All sessions are cloaked.</p>
    </div>
    <div class="game-grid" id="gameGrid">
      <!-- HARDCODED GAME CARD - uses data attribute to avoid quote escaping -->
      <div class="game-card" onclick="launchGame()">
        <img class="game-thumb" src="https://cdn.jsdelivr.net/gh/AnonN10/glh/patch/webgl.png" alt="Gladihoppers" style="background:linear-gradient(135deg,#1a1a2e,#2d2b55)">
        <div class="game-info">
          <div class="game-name">Gladihoppers</div>
          <div class="game-tags">
            <span class="game-tag">Action</span>
            <span class="game-tag">Fighting</span>
            <span class="game-tag">Casual</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- GAME VIEW -->
  <div class="game-view" id="gameView"></div>

  <script>
    function launchGame() {
      document.getElementById('library').style.display = 'none';
      document.getElementById('gameView').innerHTML = '<iframe src="https://canvasinstructure.netlify.app/game.html" allow="fullscreen; autoplay" allowfullscreen style="width:100%;height:100%;border:none"></iframe>';
      document.getElementById('gameView').classList.add('show');
      document.getElementById('backBtn').style.display = 'flex';
      document.getElementById('fsBtn').style.display = 'flex';
      document.getElementById('barGameTitle').textContent = 'Gladihoppers';
    }

    function goBack() {
      document.getElementById('gameView').classList.remove('show');
      document.getElementById('gameView').innerHTML = '';
      document.getElementById('library').style.display = 'block';
      document.getElementById('backBtn').style.display = 'none';
      document.getElementById('fsBtn').style.display = 'none';
      document.getElementById('barGameTitle').textContent = '';
      if (document.fullscreenElement) document.exitFullscreen();
    }

    function toggleFS() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && document.getElementById('gameView').classList.contains('show')) goBack();
    });
  \x3C/script>
</body>
</html>`;

    // â”€â”€â”€ CORE LOGIC â”€â”€â”€
    var STORAGE_KEY = 'sg_activated';

    function isActivated() {
      return localStorage.getItem(STORAGE_KEY) === 'true';
    }

    function launchSequence() {
      // Step 1: Open about:blank tab
      var gameTab = window.open('about:blank', '_blank');

      if (!gameTab || gameTab.closed || typeof gameTab.closed === 'undefined') {
        alert('Popup was blocked! Please allow popups for this site and try again.');
        return;
      }

      // Step 2: Inject content via iframe to keep URL as about:blank
      // (document.write changes the URL in some browsers)
      var doc = gameTab.document;
      doc.title = 'Canvas - Dashboard';
      var link = doc.createElement('link');
      link.rel = 'icon';
      link.href = 'https://du11hjcvx0uqb.cloudfront.net/dist/images/favicon-e10d657a73.ico';
      doc.head.appendChild(link);
      var s = doc.createElement('style');
      s.textContent = '*{margin:0;padding:0;overflow:hidden}';
      doc.head.appendChild(s);
      var iframe = doc.createElement('iframe');
      iframe.style.cssText = 'position:fixed;top:0;left:0;width:100vw;height:100vh;border:none';
      iframe.setAttribute('allowfullscreen', '');
      iframe.setAttribute('allow', 'fullscreen');
      doc.body.appendChild(iframe);
      iframe.contentDocument.open();
      iframe.contentDocument.write(CLOAKED_HTML);
      iframe.contentDocument.close();

      gameTab.focus();

      // Step 3: Redirect THIS tab to Canvas as cover
      setTimeout(function() {
        window.location.href = 'https://allenisd.instructure.com/?login_success=1';
      }, 100);
    }

    function activateSite() {
      localStorage.setItem(STORAGE_KEY, 'true');
      launchSequence();
    }

    function init() {
      if (isActivated()) {
        // Returning user: BIG obvious launch screen with countdown
        var countdown = 10;
        var countdownInterval;
        
        document.getElementById('loadingContent').innerHTML = '<div class="launch-screen">' +
          '<div class="launch-ring">' +
            '<svg viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>' +
          '</div>' +
          '<div class="launch-title">READY TO LAUNCH</div>' +
          '<div class="launch-subtitle">Your cloaked gaming session is prepared</div>' +
          '<div class="launch-click">ðŸ‘† CLICK ANYWHERE OR PRESS ANY KEY ðŸ‘†</div>' +
          '<div class="launch-countdown" id="countdownNum">' + countdown + '</div>' +
          '<div class="launch-warning">Auto-closing in <span id="countdownText">' + countdown + '</span> seconds if no action...</div>' +
        '</div>';
        
        document.getElementById('loading').style.cursor = 'pointer';
        
        // Start countdown
        countdownInterval = setInterval(function() {
          countdown--;
          var numEl = document.getElementById('countdownNum');
          var textEl = document.getElementById('countdownText');
          if (numEl) numEl.textContent = countdown;
          if (textEl) textEl.textContent = countdown;
          
          if (countdown <= 0) {
            clearInterval(countdownInterval);
            window.close();
            // Fallback if window.close() doesn't work
            document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#0a0a0f;color:#ef4444;font-family:sans-serif;font-size:24px;text-align:center;padding:20px;">Session timed out.<br>Please close this tab manually.</div>';
          }
        }, 1000);
        
        function launchOnGesture() {
          clearInterval(countdownInterval);
          document.removeEventListener('click', launchOnGesture);
          document.removeEventListener('keydown', launchOnGesture);
          document.getElementById('loadingContent').innerHTML = '<div class="launch-screen">' +
            '<div class="spinner" style="width:64px;height:64px;margin:0 auto 24px;"></div>' +
            '<div class="launch-title" style="font-size:32px;">DEPLOYING...</div>' +
            '<div class="launch-subtitle">Opening cloaked session</div>' +
          '</div>';
          launchSequence();
        }
        
        document.addEventListener('click', launchOnGesture);
        document.addEventListener('keydown', launchOnGesture);
      } else {
        // First time: show activation card
        setTimeout(function() {
          document.getElementById('loading').classList.add('hidden');
        }, 600);
        document.getElementById('firstTimeCard').style.display = 'block';
      }
    }

    init();
  </script>
</body>
</html>